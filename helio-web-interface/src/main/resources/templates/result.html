<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe de An√°lisis ‚Äî HelioRoute</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --color-bg: #0a0e27;
            --color-primary: #4f46e5;
            --color-accent: #06b6d4;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
            --color-text: #e2e8f0;
            --color-text-muted: #94a3b8;
            --color-surface: #1e293b;
            --color-border: rgba(148, 163, 184, 0.1);
        }
        
        body {
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f4a 100%);
            font-family: 'Inter', sans-serif;
            color: var(--color-text);
            min-height: 100vh;
            margin: 0;
            padding: 2rem 0;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(79, 70, 229, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(6, 182, 212, 0.06) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
            position: relative;
            z-index: 1;
        }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.5);
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.6);
        }
        
        .header-section {
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.9), rgba(6, 182, 212, 0.7));
            backdrop-filter: blur(10px);
            padding: 3rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.3);
        }
        
        .header-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }
        
        .header-meta {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            opacity: 0.9;
            font-size: 0.95rem;
        }
        
        .header-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-icon {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            backdrop-filter: blur(10px);
        }
        
        .alert-banner {
            border-left: 4px solid;
            padding: 1.5rem;
            border-radius: 12px;
            background: rgba(30, 41, 59, 0.8);
        }
        
        .alert-high { border-color: var(--color-danger); }
        .alert-medium { border-color: var(--color-warning); }
        .alert-low { border-color: var(--color-success); }
        
        .metric-card {
            text-align: center;
            padding: 2rem 1.5rem;
            border-radius: 16px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--color-border);
            transition: all 0.2s;
            height: 100%;
        }
        
        .metric-card:hover {
            background: rgba(15, 23, 42, 0.8);
            border-color: rgba(79, 70, 229, 0.5);
        }
        
        .metric-value {
            font-size: 2.75rem;
            font-weight: 800;
            line-height: 1;
            margin: 0.75rem 0;
            background: linear-gradient(135deg, #fff, var(--color-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .metric-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--color-text-muted);
            font-weight: 600;
        }
        
        .metric-unit {
            font-size: 1.25rem;
            color: var(--color-text-muted);
            margin-left: 0.25rem;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            padding-left: 1rem;
            border-left: 4px solid var(--color-accent);
            color: var(--color-text);
        }
        
        .uv-badge {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.75rem;
            margin: 0 auto;
            color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        .uv-low { background: linear-gradient(135deg, #10b981, #059669); }
        .uv-mod { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .uv-high { background: linear-gradient(135deg, #f97316, #ea580c); }
        .uv-very-high { background: linear-gradient(135deg, #ef4444, #dc2626); }
        
        .info-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 12px;
            border: 1px solid var(--color-border);
        }
        
        .info-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .icon-blue { background: rgba(79, 70, 229, 0.2); color: var(--color-primary); }
        .icon-cyan { background: rgba(6, 182, 212, 0.2); color: var(--color-accent); }
        .icon-green { background: rgba(16, 185, 129, 0.2); color: var(--color-success); }
        
        .chart-container {
            padding: 2rem;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 16px;
            border: 1px solid var(--color-border);
        }
        
        .btn-back {
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            border: none;
            padding: 1rem 3rem;
            font-weight: 600;
            border-radius: 12px;
            color: white;
            box-shadow: 0 4px 14px rgba(79, 70, 229, 0.4);
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-back:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.5);
            color: white;
        }
        
        .risk-badge {
            padding: 0.5rem 1.25rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
        }
        
        .risk-high {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .risk-med {
            background: rgba(245, 158, 11, 0.2);
            color: #fcd34d;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .risk-low {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .recommendation-box {
            background: rgba(79, 70, 229, 0.1);
            border: 1px solid rgba(79, 70, 229, 0.3);
            border-radius: 16px;
            padding: 2rem;
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .rec-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            flex-shrink: 0;
        }
        
        .icon-svg {
            width: 40px;
            height: 40px;
            stroke: white;
            fill: none;
            stroke-width: 2;
        }
        
        .alert-banner h5, .alert-banner p {
            color: var(--color-text);
        }
        
        .info-row .fw-bold, .info-row .metric-label {
            color: var(--color-text);
        }
        
        .info-row .small {
            color: var(--color-text-muted);
        }
        
        .glass-card .small {
            color: var(--color-text-muted) !important;
        }
        
        .recommendation-box h5, .recommendation-box p {
            color: var(--color-text);
        }

        .location-image-card {
            height: 100%;
            background-size: cover;
            background-position: center;
            border-radius: 20px;
            position: relative;
            min-height: 250px;
        }
        
        .location-image-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 2rem;
            border-radius: 0 0 20px 20px;
        }

        #map-container {
            height: 300px;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--color-border);
        }
        
        .wiki-text {
            color: #ffffff !important;
            font-size: 16px !important;
            line-height: 1.9 !important;
            font-weight: 400 !important;
        }
        
        .wiki-title {
            color: #ffffff !important;
        }
    </style>
</head>
<body>
    <div class="container dashboard-container" id="report-content">
        
        <!-- Header -->
        <div class="header-section">
            <div class="row align-items-center">
                <div class="col-lg-9">
                    <div class="mb-2" style="opacity: 0.8; text-transform: uppercase; font-size: 0.875rem; letter-spacing: 1px; font-weight: 600;">Informe T√©cnico de Monta√±a</div>
                    <h1 class="header-title" th:text="${result.locationName != 'Ubicaci√≥n desconocida' ? 'An√°lisis: ' + result.locationName : 'An√°lisis de Viabilidad'}">An√°lisis de Viabilidad</h1>
                    
                    <div class="header-meta mt-3">
                        <div class="header-meta-item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                            <span th:text="${#numbers.formatDecimal(lat, 1, 4)}"></span>¬∞,
                            <span th:text="${#numbers.formatDecimal(lon, 1, 4)}"></span>¬∞
                        </div>
                        <div class="header-meta-item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>
                            <span th:text="${result.elevation}"></span> m s.n.m.
                        </div>
                        <div class="header-meta-item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                            <span th:text="${time}"></span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 text-center mt-4 mt-lg-0">
                    <div class="status-icon mx-auto" th:if="${result.sunny}">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="2">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </div>
                    <div class="status-icon mx-auto" th:unless="${result.sunny}">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2">
                            <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>
                        </svg>
                    </div>
                    <div class="mt-2 fw-semibold" th:text="${result.sunny ? 'Condiciones Despejadas' : 'Nublado / Sombra'}"></div>
                </div>
            </div>
        </div>

        <!-- Location Info Section (Wiki) - Visible prominently at the top -->
        <div class="glass-card mb-4" id="wiki-section" th:if="${result.locationDescription != null or result.wikiUrl != null}" style="background: rgba(30, 41, 59, 0.95);">
            <div class="p-4">
                <h5 class="section-title mb-4 wiki-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#06b6d4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 0.5rem;">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                    <span th:text="${result.locationName}">Ubicaci√≥n</span>
                </h5>
                <div class="row">
                    <div class="col-md-8">
                        <p class="mb-3 wiki-text" th:if="${result.locationDescription != null}" th:text="${result.locationDescription}"></p>
                        <p class="mb-3 wiki-text" th:unless="${result.locationDescription != null}">No se encontr√≥ informaci√≥n detallada sobre esta ubicaci√≥n en Wikipedia.</p>
                        <a th:if="${result.wikiUrl != null}" th:href="${result.wikiUrl}" target="_blank" class="btn btn-sm" style="background: #06b6d4; color: #ffffff; border: none; padding: 0.6rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-block; margin-top: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.5rem;">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                <polyline points="15 3 21 3 21 9"></polyline>
                                <line x1="10" y1="14" x2="21" y2="3"></line>
                            </svg>
                            Leer m√°s en Wikipedia
                        </a>
                    </div>
                    <div class="col-md-4 text-center" th:if="${result.locationImageUrl != null}">
                        <img id="wiki-image" th:src="${result.locationImageUrl}" class="img-fluid rounded-3 shadow" alt="Imagen de la ubicaci√≥n" style="max-height: 250px; object-fit: cover; width: 100%;" crossorigin="anonymous">
                    </div>
                </div>
            </div>
        </div>

        <!-- Alert Banner -->
        <div class="glass-card alert-banner mb-4" 
             th:classappend="${result.safetyAlert.contains('ALTO') ? 'alert-high' : (result.safetyAlert.contains('Moderate') ? 'alert-medium' : 'alert-low')}">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="mb-2 fw-bold">Diagn√≥stico de Seguridad</h5>
                    <p class="mb-0" style="opacity: 0.9;" th:text="${result.safetyAlert}"></p>
                </div>
                <span class="risk-badge" 
                      th:classappend="${result.safetyAlert.contains('ALTO') ? 'risk-high' : (result.safetyAlert.contains('Moderate') ? 'risk-med' : 'risk-low')}"
                      th:text="${result.safetyAlert.contains('ALTO') ? 'Alto Riesgo' : (result.safetyAlert.contains('Moderate') ? 'Precauci√≥n' : 'Seguro')}"></span>
            </div>
        </div>

        <!-- Map Section -->
        <div class="row g-4 mb-4">
             <div class="col-12">
                 <div class="glass-card p-0">
                     <div id="map-container" style="height: 300px;"></div>
                 </div>
             </div>
        </div>

        <!-- Metric Grid -->
        <div class="row g-3 mb-4">
            <div class="col-md-3 col-sm-6">
                <div class="glass-card metric-card">
                    <div class="metric-label">Altitud del Modelo</div>
                    <div class="metric-value"><span th:text="${result.elevation}"></span><span class="metric-unit">m</span></div>
                    <div class="text-muted small mt-2">Dato del Modelo</div>
                    <div class="small fw-bold text-info mt-1" th:if="${result.realAltitude != null}" th:text="'Topogr√°fica: ' + ${#numbers.formatInteger(result.realAltitude, 0)} + ' m'"></div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="glass-card metric-card">
                    <div class="metric-label">Temperatura</div>
                    <div class="metric-value"><span th:text="${result.temperature}"></span><span class="metric-unit">¬∞C</span></div>
                    <div class="text-muted small mt-2"><span th:text="${result.thermalSensation}"></span></div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="glass-card metric-card">
                    <div class="metric-label">Viento</div>
                    <div class="metric-value"><span th:text="${result.windSpeed}"></span><span class="metric-unit">km/h</span></div>
                    <div class="text-muted small mt-2">A 10m de altura</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="glass-card metric-card">
                    <div class="metric-label">√çndice UV</div>
                    <div class="uv-badge mt-3" 
                         th:classappend="${result.currentUvIndex > 8 ? 'uv-very-high' : (result.currentUvIndex > 5 ? 'uv-high' : (result.currentUvIndex > 2 ? 'uv-mod' : 'uv-low'))}"
                         th:text="${result.currentUvIndex}"></div>
                    <div class="text-muted small mt-2">M√°ximo del d√≠a</div>
                </div>
            </div>
        </div>

        <!-- Mountain Technical Data -->
        <h5 class="section-title">Condiciones Atmosf√©ricas de Alta Monta√±a</h5>
        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <div class="glass-card info-row">
                    <div class="info-icon icon-blue">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 17.58A5 5 0 0 0 18 8h-1.26A8 8 0 1 0 4 16.25"></path>
                            <line x1="8" y1="16" x2="8.01" y2="16"></line>
                            <line x1="8" y1="20" x2="8.01" y2="20"></line>
                            <line x1="12" y1="18" x2="12.01" y2="18"></line>
                            <line x1="12" y1="22" x2="12.01" y2="22"></line>
                            <line x1="16" y1="16" x2="16.01" y2="16"></line>
                            <line x1="16" y1="20" x2="16.01" y2="20"></line>
                        </svg>
                    </div>
                    <div>
                        <div class="metric-label mb-1">Isoterma 0¬∞C</div>
                        <div class="fw-bold fs-4" th:text="${result.freezingLevel + ' m'}"></div>
                        <div class="small text-warning mt-1" th:if="${result.elevation > result.freezingLevel}">
                            <svg style="width: 14px; height: 14px; vertical-align: middle;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                <line x1="12" y1="9" x2="12" y2="13"></line>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            Por encima de l√≠nea de congelaci√≥n
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="glass-card info-row">
                    <div class="info-icon icon-cyan">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </div>
                    <div>
                        <div class="metric-label mb-1">Visibilidad</div>
                        <div class="fw-bold fs-4" th:text="${(result.visibility / 1000) + ' km'}"></div>
                        <div class="small text-danger mt-1" th:if="${result.visibility < 1000}">
                            <svg style="width: 14px; height: 14px; vertical-align: middle;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                <line x1="12" y1="9" x2="12" y2="13"></line>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            Visibilidad reducida
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="glass-card info-row">
                    <div class="info-icon icon-green">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <div class="metric-label mb-1">Presi√≥n Atmosf√©rica</div>
                        <div class="fw-bold fs-4" th:text="${result.pressure + ' hPa'}"></div>
                        <div class="small text-muted mt-1">Nivel de ox√≠geno relativo</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Solar Cycle -->
        <div class="glass-card p-4 mb-4">
            <h5 class="section-title">Ciclo Solar</h5>
            <div class="row text-center">
                <div class="col-md-6 mb-3 mb-md-0">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="2" style="opacity: 0.8;">
                        <path d="M17 18a5 5 0 0 0-10 0"></path>
                        <line x1="12" y1="2" x2="12" y2="9"></line>
                        <line x1="4.22" y1="10.22" x2="5.64" y2="11.64"></line>
                        <line x1="1" y1="18" x2="3" y2="18"></line>
                        <line x1="21" y1="18" x2="23" y2="18"></line>
                        <line x1="18.36" y1="11.64" x2="19.78" y2="10.22"></line>
                        <line x1="23" y1="22" x2="1" y2="22"></line>
                        <polyline points="8 6 12 2 16 6"></polyline>
                    </svg>
                    <div class="metric-label mt-2">Amanecer</div>
                    <div class="fw-bold fs-3 mt-1" th:text="${result.sunrise}"></div>
                </div>
                <div class="col-md-6">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2" style="opacity: 0.8;">
                        <path d="M17 18a5 5 0 0 0-10 0"></path>
                        <line x1="12" y1="9" x2="12" y2="2"></line>
                        <line x1="4.22" y1="10.22" x2="5.64" y2="11.64"></line>
                        <line x1="1" y1="18" x2="3" y2="18"></line>
                        <line x1="21" y1="18" x2="23" y2="18"></line>
                        <line x1="18.36" y1="11.64" x2="19.78" y2="10.22"></line>
                        <line x1="23" y1="22" x2="1" y2="22"></line>
                        <polyline points="16 5 12 9 8 5"></polyline>
                    </svg>
                    <div class="metric-label mt-2">Atardecer</div>
                    <div class="fw-bold fs-3 mt-1" th:text="${result.sunset}"></div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="glass-card mb-4">
            <div class="p-4">
                <h5 class="section-title">Evoluci√≥n en las pr√≥ximas 24 horas</h5>
                <div class="chart-container">
                    <canvas id="weatherChart" height="90"></canvas>
                </div>
            </div>
        </div>

        <!-- Recommendations -->
        <div class="glass-card mb-5">
            <div class="recommendation-box">
                <div class="rec-icon">
                    <svg class="icon-svg" viewBox="0 0 24 24">
                        <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
                        <line x1="16" y1="8" x2="2" y2="22"></line>
                        <line x1="17.5" y1="15" x2="9" y2="15"></line>
                    </svg>
                </div>
                <div>
                    <h5 class="fw-bold mb-2">Recomendaci√≥n de Equipamiento</h5>
                    <p class="mb-0 fs-5" style="line-height: 1.6;" th:text="${result.clothingRecommendation}"></p>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-5 mb-5 d-flex gap-3 justify-content-center" data-html2canvas-ignore="true">
            <a href="/" class="btn-back">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 0.5rem;"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                Nuevo An√°lisis
            </a>
            <button onclick="exportPFD()" class="btn-back" style="background: var(--color-surface); border: 1px solid var(--color-primary);">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 0.5rem;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                Exportar PDF
            </button>
        </div>
    </div>

    <!-- PDF Clean Version (Hidden, only for export) -->
    <div id="pdf-clean-version" style="display: none; font-family: 'Inter', sans-serif; color: #1a1f4a; background: white; padding: 40px; max-width: 800px; margin: 0 auto;">
        <div style="text-align: center; margin-bottom: 40px; border-bottom: 3px solid #4f46e5; padding-bottom: 20px;">
            <h1 style="font-size: 28px; font-weight: 800; color: #1a1f4a; margin-bottom: 10px;">HELIOROUTE - Informe de An√°lisis de Monta√±a</h1>
            <p style="font-size: 14px; color: #64748b; margin: 0;" id="pdf-location-name"></p>
            <p style="font-size: 12px; color: #94a3b8; margin-top: 5px;" id="pdf-coordinates"></p>
            <p style="font-size: 12px; color: #94a3b8;" id="pdf-date"></p>
        </div>

        <!-- Wiki Section for PDF -->
        <div id="pdf-wiki-section" style="margin-bottom: 30px; padding: 20px; background: #f1f5f9; border-left: 4px solid #06b6d4; border-radius: 8px;">
            <h3 style="font-size: 18px; font-weight: 700; color: #1a1f4a; margin-bottom: 15px;">Informaci√≥n de la Ubicaci√≥n</h3>
            <div style="display: flex; gap: 20px; align-items: flex-start;">
                <div style="flex: 1;">
                    <p id="pdf-wiki-desc" style="font-size: 13px; line-height: 1.6; color: #475569;"></p>
                    <p id="pdf-wiki-url" style="font-size: 11px; color: #06b6d4; margin-top: 10px;"></p>
                </div>
                <img id="pdf-wiki-img" style="max-width: 200px; border-radius: 8px; display: none;" />
            </div>
        </div>

        <h3 style="font-size: 18px; font-weight: 700; color: #1a1f4a; margin-bottom: 15px; margin-top: 30px;">Resumen de Condiciones</h3>
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px; font-size: 13px;">
            <thead>
                <tr style="background: #4f46e5; color: white;">
                    <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Par√°metro</th>
                    <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Valor</th>
                    <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Observaciones</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd; font-weight: 600;">Altitud del Modelo</td>
                    <td id="pdf-elevation" style="padding: 10px; border: 1px solid #ddd;"></td>
                    <td style="padding: 10px; border: 1px solid #ddd; color: #64748b;">Sobre el nivel del mar</td>
                </tr>
                <tr style="background: #f8fafc;">
                    <td style="padding: 10px; border: 1px solid #ddd; font-weight: 600;">Temperatura</td>
                    <td id="pdf-temperature" style="padding: 10px; border: 1px solid #ddd;"></td>
                    <td id="pdf-thermal" style="padding: 10px; border: 1px solid #ddd; color: #64748b;"></td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd; font-weight: 600;">Viento</td>
                    <td id="pdf-wind" style="padding: 10px; border: 1px solid #ddd;"></td>
                    <td style="padding: 10px; border: 1px solid #ddd; color: #64748b;">A 10m de altura</td>
                </tr>
                <tr style="background: #f8fafc;">
                    <td style="padding: 10px; border: 1px solid #ddd; font-weight: 600;">√çndice UV</td>
                    <td id="pdf-uv" style="padding: 10px; border: 1px solid #ddd;"></td>
                    <td id="pdf-uv-desc" style="padding: 10px; border: 1px solid #ddd; color: #64748b;"></td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd; font-weight: 600;">Condiciones</td>
                    <td id="pdf-sunny" style="padding: 10px; border: 1px solid #ddd;"></td>
                    <td style="padding: 10px; border: 1px solid #ddd; color: #64748b;">Estado del cielo</td>
                </tr>
            </tbody>
        </table>

        <h3 style="font-size: 18px; font-weight: 700; color: #1a1f4a; margin-bottom: 15px;">Condiciones Atmosf√©ricas de Alta Monta√±a</h3>
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px; font-size: 13px;">
            <thead>
                <tr style="background: #06b6d4; color: white;">
                    <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Par√°metro</th>
                    <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Valor</th>
                    <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Estado</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd; font-weight: 600;">Isoterma 0¬∞C</td>
                    <td id="pdf-freezing" style="padding: 10px; border: 1px solid #ddd;"></td>
                    <td id="pdf-freezing-alert" style="padding: 10px; border: 1px solid #ddd; color: #64748b;"></td>
                </tr>
                <tr style="background: #f8fafc;">
                    <td style="padding: 10px; border: 1px solid #ddd; font-weight: 600;">Visibilidad</td>
                    <td id="pdf-visibility" style="padding: 10px; border: 1px solid #ddd;"></td>
                    <td id="pdf-visibility-alert" style="padding: 10px; border: 1px solid #ddd; color: #64748b;"></td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd; font-weight: 600;">Presi√≥n Atmosf√©rica</td>
                    <td id="pdf-pressure" style="padding: 10px; border: 1px solid #ddd;"></td>
                    <td style="padding: 10px; border: 1px solid #ddd; color: #64748b;">Nivel de ox√≠geno relativo</td>
                </tr>
            </tbody>
        </table>

        <h3 style="font-size: 18px; font-weight: 700; color: #1a1f4a; margin-bottom: 15px;">Ciclo Solar</h3>
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px; font-size: 13px;">
            <tr>
                <td style="padding: 15px; border: 1px solid #ddd; font-weight: 600; background: #fff7ed;">Amanecer</td>
                <td id="pdf-sunrise" style="padding: 15px; border: 1px solid #ddd; background: #fff7ed;"></td>
                <td style="padding: 15px; border: 1px solid #ddd; font-weight: 600; background: #fef2f2;">Atardecer</td>
                <td id="pdf-sunset" style="padding: 15px; border: 1px solid #ddd; background: #fef2f2;"></td>
            </tr>
        </table>

        <div id="pdf-safety-alert" style="margin-top: 30px; padding: 20px; border-radius: 8px; border: 2px solid #ef4444; background: #fef2f2;">
            <h3 style="font-size: 16px; font-weight: 700; color: #991b1b; margin-bottom: 10px;">‚ö†Ô∏è Diagn√≥stico de Seguridad</h3>
            <p id="pdf-safety-text" style="font-size: 14px; line-height: 1.6; color: #7f1d1d; margin: 0;"></p>
        </div>

        <div id="pdf-recommendation" style="margin-top: 20px; padding: 20px; border-radius: 8px; background: #eff6ff; border-left: 4px solid #4f46e5;">
            <h3 style="font-size: 16px; font-weight: 700; color: #1e40af; margin-bottom: 10px;">üéí Recomendaci√≥n de Equipamiento</h3>
            <p id="pdf-rec-text" style="font-size: 14px; line-height: 1.6; color: #1e3a8a; margin: 0;"></p>
        </div>

        <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #e2e8f0; text-align: center; font-size: 11px; color: #94a3b8;">
            <p>Generado por HelioRoute - Sistema de An√°lisis de Viabilidad en Monta√±a</p>
            <p>Fecha de generaci√≥n: <span id="pdf-gen-date"></span></p>
        </div>
    </div>

    <!-- Chart Configuration -->
    <script th:inline="javascript">
        // Export PDF Function - The "Bulletproof" Strategy + Chart + Wiki Image + Better Pagination
        // Tries to find jsPDF directly. If not, hijacks html2pdf worker.
        function exportPFD() {
            try {
                // 1. Gather Data
                const resultData = {
                    locationName: [[${result.locationName}]] || 'Ubicaci√≥n desconocida',
                    lat: [[${lat}]],
                    lon: [[${lon}]],
                    time: [[${time}]],
                    elevation: [[${result.elevation}]],
                    realAltitude: [[${result.realAltitude}]],
                    temperature: [[${result.temperature}]],
                    thermalSensation: [[${result.thermalSensation}]],
                    windSpeed: [[${result.windSpeed}]],
                    currentUvIndex: [[${result.currentUvIndex}]],
                    sunny: [[${result.sunny}]],
                    freezingLevel: [[${result.freezingLevel}]],
                    visibility: [[${result.visibility}]],
                    pressure: [[${result.pressure}]],
                    sunrise: [[${result.sunrise}]],
                    sunset: [[${result.sunset}]],
                    safetyAlert: [[${result.safetyAlert}]],
                    clothingRecommendation: [[${result.clothingRecommendation}]],
                    wikiDescription: [[${result.locationDescription}]],
                    wikiUrl: [[${result.wikiUrl}]],
                    wikiImageUrl: [[${result.locationImageUrl}]]
                };

                // 2. Capture Chart Image (Helper)
                const captureElement = (id) => {
                    const canvas = document.getElementById(id);
                    if (!canvas) return null;
                    try {
                        const w = canvas.width || canvas.clientWidth;
                        const h = canvas.height || canvas.clientHeight;
                        
                        // Treat invalid dimensions
                        if(!w || !h) return null;

                        const composite = document.createElement('canvas');
                        composite.width = w;
                        composite.height = h;
                        const ctx = composite.getContext('2d');
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, w, h);
                        
                        if (canvas.tagName === 'IMG') {
                            ctx.drawImage(canvas, 0, 0, w, h);
                        } else {
                            ctx.drawImage(canvas, 0, 0);
                        }
                        return composite.toDataURL('image/jpeg', 0.95);
                    } catch (err) {
                        console.warn(`Capture for ${id} failed:`, err);
                        return null;
                    }
                };

                // Capture Assets
                const chartImgData = captureElement('weatherChart');
                
                // Attempt to capture Wiki Image from DOM if it exists and is loaded
                // Note: Image must have crossorigin="anonymous" if external to work consistently
                const wikiImgElement = document.getElementById('wiki-image');
                let wikiImgData = null;
                if (wikiImgElement && wikiImgElement.complete) {
                     wikiImgData = captureElement('wiki-image');
                }

                // --- PDF PAINTER FUNCTION ---
                // Defines exactly what goes on the paper
                const paintPDF = (doc) => {
                     // HARDCODED A4 SPECS (mm) to prevent Unit mix-ups (Points vs MM)
                     // If the doc thinks it's Points (595), we force our calculations to MM logic
                     // and hope the doc was initialized in MM. If not, this safeguards layout partially
                     // but ideal is doc initialized in MM.
                     const margin = 20; 
                     let y = 20;
                     // Force standard A4 size in mm
                     const pageWidth = 210; 
                     const pageHeight = 297; 
                     
                     // Helper: Check Page Break
                     const checkPageBreak = (heightNeeded) => {
                         if (y + heightNeeded > pageHeight - margin) {
                             doc.addPage();
                             y = 20;
                             return true;
                         }
                         return false;
                     };

                     // Reset styles
                     doc.setFont("helvetica", "bold");
                     doc.setFontSize(22);
                     doc.setTextColor(40, 60, 150);
                     doc.text("HelioRoute: Informe T√©cnico", margin, y);
                     
                     y += 15;
                     doc.setLineWidth(0.5);
                     doc.setDrawColor(200);
                     doc.line(margin, y, pageWidth - margin, y);
                     y += 10;
                     
                     // Helper for lines
                     const addLine = (label, value) => {
                         checkPageBreak(10);
                         doc.setFont("helvetica", "bold");
                         doc.setFontSize(11);
                         doc.setTextColor(50);
                         doc.text(label + ": ", margin, y);
                         
                         const labelWidth = doc.getTextWidth(label + ": ");
                         doc.setFont("helvetica", "normal");
                         doc.setTextColor(0);
                         if (value === null || value === undefined) value = "N/A";
                         doc.text(String(value), margin + labelWidth, y);
                         y += 7;
                     };
                     
                     const addSection = (title) => {
                         checkPageBreak(15);
                         y += 5;
                         doc.setFont("helvetica", "bold");
                         doc.setFontSize(14);
                         doc.setTextColor(0);
                         doc.text(title, margin, y);
                         y += 8;
                     };

                     // CONTENT
                     addSection("1. Ubicaci√≥n y Fecha");
                     addLine("Lugar", resultData.locationName);
                     addLine("Coordenadas", `${Number(resultData.lat).toFixed(4)}, ${Number(resultData.lon).toFixed(4)}`);
                     if (resultData.realAltitude) {
                        addLine("Altitud Topogr√°fica", `${resultData.realAltitude} m`);
                     }
                     addLine("Altitud del Modelo", `${resultData.elevation} m`);
                     addLine("Fecha Informe", resultData.time);

                     addSection("2. Meteorolog√≠a");
                     addLine("Temperatura", `${resultData.temperature} ¬∞C`);
                     addLine("Sensaci√≥n T√©rmica", resultData.thermalSensation);
                     addLine("Viento", `${resultData.windSpeed} km/h`);
                     addLine("Presi√≥n", `${resultData.pressure} hPa`);
                     addLine("Visibilidad", `${resultData.visibility} m`);
                     addLine("Cota de Nieve", `${resultData.freezingLevel} m`);

                     addSection("3. Datos Solares");
                     addLine("Condici√≥n", resultData.sunny ? "Soleado" : "Nublado/Sombra");
                     addLine("√çndice UV", resultData.currentUvIndex);
                     addLine("Amanecer", resultData.sunrise);
                     addLine("Atardecer", resultData.sunset);

                     // --- CHART SECTION ---
                     if (chartImgData) {
                         const imgHeight = 60; 
                         checkPageBreak(imgHeight + 20);
                         
                         doc.setFont("helvetica", "bold");
                         doc.setFontSize(14);
                         doc.setTextColor(0);
                         doc.text("4. Gr√°fico de Previsi√≥n (24h)", margin, y);
                         y += 8;
                         
                         const imgWidth = pageWidth - (margin * 2);
                         doc.addImage(chartImgData, 'JPEG', margin, y, imgWidth, imgHeight);
                         y += imgHeight + 10;
                     }

                     addSection("5. Seguridad y Recomendaciones");
                     
                     // Alert Box
                     checkPageBreak(40);
                     
                     doc.setFillColor(255, 240, 240);
                     doc.rect(margin, y, pageWidth - (margin*2), 20, 'F');
                     y += 5;
                     
                     doc.setFont("helvetica", "bold");
                     doc.setTextColor(200, 0, 0);
                     doc.setFontSize(10);
                     const safeText = doc.splitTextToSize("ALERTA: " + resultData.safetyAlert, pageWidth - (margin*2) - 10);
                     doc.text(safeText, margin + 5, y + 5);
                     
                     y += 25;
                     
                     doc.setFont("helvetica", "italic");
                     doc.setTextColor(0);
                     doc.setFontSize(11);
                     // Changed width to include extra buffer (-20) to prevent overflow
                     const recText = doc.splitTextToSize("Equipo: " + resultData.clothingRecommendation, pageWidth - (margin*2) - 20);
                     doc.text(recText, margin, y);
                     
                     y += (recText.length * 7) + 10;
                     
                     // Wiki
                     if (resultData.wikiDescription) {
                         checkPageBreak(50);
                         addSection("6. Contexto (Wikipedia)");
                         
                         // Image (Left or Top)
                         if (wikiImgData) {
                             // Let's put image on top if available
                             const wImgH = 50; 
                             checkPageBreak(wImgH + 20);
                             const wImgW = 80; // Fixed width for wiki image
                             
                             // Draw image
                             doc.addImage(wikiImgData, 'JPEG', margin, y, wImgW, wImgH);
                             
                             // Move cursor down
                             y += wImgH + 5; 
                         }
                         
                         // Reset font to Normal (not Italic) and ensure Helvetica
                         // This fixes width calculation issues with Italic fonts
                         doc.setFont("helvetica", "normal"); 
                         doc.setFontSize(10);
                         doc.setTextColor(60); // Slightly darker for readability
                         
                         // Manual Pagination Loop for Text
                         // Fixed Width of 120mm - EXTREMELY SAFE MARGIN
                         // Page is 210mm. Left margin 20mm. Text 120mm. 
                         // Ends at 140mm. Right margin becomes 70mm.
                         // This makes a narrow central column that cannot overflow.
                         const textWidth = 120; 
                         const fullWikiText = doc.splitTextToSize(resultData.wikiDescription, textWidth);
                         
                         // We iterate line by line to handle page breaks gracefully
                         const lineHeight = 5;
                         
                         for (let i = 0; i < fullWikiText.length; i++) {
                             if (y + lineHeight > pageHeight - margin) {
                                 doc.addPage();
                                 y = 20; // Restart top
                             }
                             doc.text(fullWikiText[i], margin, y);
                             y += lineHeight;
                         }
                         
                         y += 5;
                         
                         if (resultData.wikiUrl) {
                            checkPageBreak(10);
                            doc.setTextColor(0, 0, 255);
                            doc.textWithLink("Leer m√°s en Wikipedia", margin, y, { url: resultData.wikiUrl });
                        }
                     }
                     
                     // Page Numbers
                     const pageCount = doc.internal.getNumberOfPages();
                     for(let i = 1; i <= pageCount; i++) {
                        doc.setPage(i);
                        doc.setFontSize(8);
                        doc.setTextColor(150);
                        doc.text(`P√°g ${i} de ${pageCount} | Generado: ${new Date().toLocaleString()}`, margin, 285);
                    }
                };

                // --- EXECUTION STRATEGY ---
                const filename = 'HelioRoute_' + resultData.locationName.replace(/[^a-z0-9]/gi, '_') + '.pdf';
                let pdfEngine = null;
                
                // Explicit options to avoid unit confusion
                const pdfOptions = { orientation: 'p', unit: 'mm', format: 'a4' };

                // Priority 1: Window.jspdf (Newer versions)
                if (window.jspdf && window.jspdf.jsPDF) {
                    console.log("Using window.jspdf.jsPDF");
                    pdfEngine = new window.jspdf.jsPDF(pdfOptions);
                } 
                // Priority 2: Window.jsPDF (Older versions/Globals)
                else if (window.jsPDF) {
                    console.log("Using window.jsPDF");
                    pdfEngine = new window.jsPDF(pdfOptions);
                }

                if (pdfEngine) {
                    // Direct approach
                    paintPDF(pdfEngine);
                    pdfEngine.save(filename);
                } else {
                    // Priority 3: html2pdf wrapper
                    console.log("Using html2pdf worker fallback");
                    const dummy = document.createElement('div');
                    dummy.innerHTML = "x"; // Ensure content exists
                    
                    const opt = {
                        margin: 10,
                        jsPDF: { unit: 'mm', format: 'a4' }
                    };
                    
                    html2pdf().from(dummy).set(opt).toPdf().get('pdf').then(function(doc) {
                        // IMPORTANT: Add a clean page to ensure no canvas artifacts
                        doc.addPage();
                        doc.setPage(2);
                        doc.deletePage(1); // Remove the dummy page
                        
                        paintPDF(doc);
                        doc.save(filename);
                    }).catch(e => {
                        alert("Error generando PDF: " + e.message);
                    });
                }

            } catch (e) {
                console.error("Setup error:", e);
                alert("Error preparando datos: " + e.message);
            }
        }

        // Initialize Map
        const lat = [[${lat}]];
        const lon = [[${lon}]];
        
        if (lat && lon) {
             // Create map with slight delay to ensure container is ready
             setTimeout(() => {
                const map = L.map('map-container').setView([lat, lon], 13);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
                    subdomains: 'abcd',
                    maxZoom: 19
                }).addTo(map);

                L.marker([lat, lon]).addTo(map)
                    .bindPopup('<b>' + ([[${result.locationName}]] || 'Ubicaci√≥n') + '</b>')
                    .openPopup();
                 
                 // Force map resize just in case
                 map.invalidateSize();
             }, 100);
        }

        const hourlyData = [[${result.hourlyForecast}]];
        
        if (hourlyData && hourlyData.length > 0) {
            const labels = hourlyData.map(h => h.time.substring(11, 16)); // Extract HH:mm
            const temps = hourlyData.map(h => h.temperature);
            const winds = hourlyData.map(h => h.windSpeed);
            const uvs = hourlyData.map(h => h.uvIndex);

            const ctx = document.getElementById('weatherChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Temperatura (¬∞C)',
                            data: temps,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Viento (km/h)',
                            data: winds,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                         {
                            label: 'UV Index',
                            data: uvs,
                            borderColor: '#f1c40f',
                            borderDash: [5, 5],
                            borderWidth: 2,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'Temp / Viento' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            title: { display: true, text: 'UV Index' }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>